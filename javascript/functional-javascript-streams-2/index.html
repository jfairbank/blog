<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Functional JavaScript Part 2: Streams &#8211; Jeremy Fairbank Blog</title>
<meta name="description" content="Learn about streams with functional programming in JavaScript.">
<meta name="keywords" content="javascript, functional programming">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Functional JavaScript Part 2: Streams">
<meta name="twitter:description" content="Learn about streams with functional programming in JavaScript.">
<meta name="twitter:site" content="@ElPapaPollo">
<meta name="twitter:creator" content="@ElPapaPollo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.jeremyfairbank.com/images/bio-photo-1.jpg">
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Functional JavaScript Part 2: Streams">
<meta property="og:description" content="Learn about streams with functional programming in JavaScript.">
<meta property="og:url" content="http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/">
<meta property="og:site_name" content="Jeremy Fairbank Blog">
<meta property="og:image" content="http://blog.jeremyfairbank.com/images/bio-photo-1.jpg">





<link rel="canonical" href="http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/">
<link href="http://blog.jeremyfairbank.com/feed.xml" type="application/atom+xml" rel="alternate" title="Jeremy Fairbank Blog Feed">
<link rel="author" href="http://plus.google.com/+JeremyFairbank?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link href='/stylesheets/all-b8c2da235318df18791e8ddcdf81de63.css' media='all' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://blog.jeremyfairbank.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://blog.jeremyfairbank.com/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://blog.jeremyfairbank.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://blog.jeremyfairbank.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://blog.jeremyfairbank.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://blog.jeremyfairbank.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://blog.jeremyfairbank.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://blog.jeremyfairbank.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://blog.jeremyfairbank.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://blog.jeremyfairbank.com/images/apple-touch-icon-144x144-precomposed.png">
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://blog.jeremyfairbank.com/">Jeremy Fairbank Blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="http://blog.jeremyfairbank.com/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="http://blog.jeremyfairbank.com/posts/" >Posts</a></li>
				
				    
				        
				        
				    <li><a href="http://jeremyfairbank.com" target="_blank">jeremyfairbank.com</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    <div itemscope itemtype="http://data-vocabulary.org/Person">
  
    <img itemprop="photo" src="http://blog.jeremyfairbank.com/images/bio-photo-1.jpg" class="bio-photo" alt="Jeremy Fairbank bio photo">
  
  <h3 itemprop="name">Jeremy Fairbank</h3>
  <p>
    <span itemprop="role">Web Developer</span>.
    <span itemprop="address" itemscope><span itemprop="locality">Tennessee</span></span>.
    Making the web with JavaScript.
  </p>
  
  <a href="http://twitter.com/ElPapaPollo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JeremyFairbank" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  
  <a href="http://instagram.com/elpapapollo" class="author-social" target="_blank"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
  
  <a href="http://github.com/jfairbank" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
</div>
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" rel="bookmark" title="Functional JavaScript Part 2: Streams">Functional JavaScript Part 2: Streams</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <div class="social-share">
  <ul class="inline-list">
    <li class="facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Share</span></a>
    </li>
    <li class="twitter">
      <a href="https://twitter.com/intent/tweet?text=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a>
    </li>
    <li class="googleplus">
      <a href="https://plus.google.com/share?url=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a>
    </li>
  </ul>
</div>
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#streams" id="markdown-toc-streams">Streams</a></li>
  <li><a href="#creating-streams-with-generators" id="markdown-toc-creating-streams-with-generators">Creating Streams with Generators</a></li>
  <li><a href="#creating-the-stream-data-structure" id="markdown-toc-creating-the-stream-data-structure">Creating the Stream Data Structure</a></li>
  <li><a href="#the-take-function" id="markdown-toc-the-take-function">The <em>take</em> Function</a></li>
  <li><a href="#creating-other-streams" id="markdown-toc-creating-other-streams">Creating Other Streams</a></li>
  <li><a href="#mapping-over-streams" id="markdown-toc-mapping-over-streams">Mapping Over Streams</a></li>
  <li><a href="#filtering-streams" id="markdown-toc-filtering-streams">Filtering Streams</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<p>This post picks up from a series on functional programming I started a few
months ago. In
<a href="/javascript/functional-javascript-lists-1/">the last post</a>, I explained
recursion and immutability through constructing the list data structure. In this
post, we will examine another concept in functional programming: <strong>streams</strong>.</p>

<h2 id="streams">Streams</h2>

<p>So, what are streams? I am sure you have probably heard of streams in JavaScript
and <a href="https://nodejs.org/api/stream.html">Node</a> before, and streams in functional
programming are similar. One important use case for streams in functional
programming is to represent infinite data sequences such as the natural numbers.</p>

<p>But what is so special about streams? Well, just like streams in Node, we can
work with data in small chunks, avoiding exhausting memory. Imagine trying to
represent all the natural numbers in memory! When I say that we work in “small
chunks,” I mean that we delay getting values in a stream until necessary. This
is called <em>lazy evaluation</em>.</p>

<p>With a stream of natural numbers, that means I would start the stream with the
value <code>1</code>. I would have to consume the stream again to get the next value of
<code>2</code>. Repeating this process would yield <code>3</code>, <code>4</code>, and so on.</p>

<h2 id="creating-streams-with-generators">Creating Streams with Generators</h2>

<p>If you have kept up with ES2015, this concept might sound familiar. Generator
functions afford us the power of streams in JavaScript. So how would we create a
stream of the natural numbers with generators?</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">natural-numbers-generator-imperative.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="o">*</span><span class="nx">naturalNumbers</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">yield</span> <span class="nx">n</span><span class="o">++</span><span class="p">;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">naturalNumbers</span><span class="p">();</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 1</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 2</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 3</span></div></div></pre></div></figure>

<p>This is a pretty straightforward implementation. We keep track of the current
number in the sequence with <code>n</code>. We set <code>n = 1</code> because naturally (pun intended)
the natural numbers start with 1. Then, inside an infinite loop, we yield <code>n</code>
and increment it to the next number in the sequence.</p>

<p>However, this implementation is not very functional. We use mutation by
reassigning values to <code>n</code>. We could alter the implementation to use recursion:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">natural-numbers-generator-recursive.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="o">*</span><span class="nx">naturalNumbers</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="o">*</span><span class="nx">_naturalNumbers</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">yield</span> <span class="nx">n</span><span class="p">;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">yield</span> <span class="o">*</span><span class="nx">_naturalNumbers</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">yield</span> <span class="o">*</span><span class="nx">_naturalNumbers</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">naturalNumbers</span><span class="p">();</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 1</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 2</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nats</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 3</span></div></div></pre></div></figure>

<p>Now we create a generator function that uses an internal generator function
called <code>_naturalNumbers</code>. It takes <code>n</code> as a parameter with an initial value of
<code>1</code>. Inside our internal function, we yield <code>n</code> and then recursively yield a
call to the same function with <code>n + 1</code>. Notice the use of <code>yield *</code>. This
special syntax allows us to delegate a yielded value to another generator
function. If we had just used <code>yield</code>, we would have yielded a new instance of
the generator instead of the next number in the sequence.</p>

<p>There is still a problem with this implementation, though. Notice how we consume
our values with <code>nats.next().value</code>. That generator has to maintain state
internally for it to be able to yield each value in the sequence. That means
some mutation is taking place. If we want to be super strict about immutability
with functional programming, then we need to roll our own stream data structure.</p>

<h2 id="creating-the-stream-data-structure">Creating the Stream Data Structure</h2>

<p>How do we accomplish creating a stream data structure? Remember that streams are
lazy structures. We evaluate the first value but delay evaluating the remaining
values. That sounds like we need some type of callback to represent the
remaining values.</p>

<p>Hey! This is starting to sound like a list too. So, we need to create some type
of data structure with a head and a tail, where the tail is evaluated at a later
point in time. An implementation could look something like this then:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">natural-numbers-functional-stream-1.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">naturalNumbers</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="p">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="na">value</span><span class="p">:</span> <span class="nx">n</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nx">next</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="p">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">_stream</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">naturalNumbers</span><span class="p">();</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">one</span> <span class="o">=</span> <span class="nx">nats</span><span class="p">();</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">two</span> <span class="o">=</span> <span class="nx">one</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">three</span> <span class="o">=</span> <span class="nx">two</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">one</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">two</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">three</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span></div></div></pre></div></figure>

<p>Now this is definitely more functional. We remove mutation and depend on
recursive calls of an internal function to generate the values in our stream.
Let’s walk through this implementation.</p>

<p>I mentioned we use recursive calls to an internal function. We create the
internal function <code>_stream</code> that takes in our <code>n</code> parameter. It returns a
list-like data structure. The head is the <code>value</code> property which contains the
value of <code>n</code>. The tail is a function called <code>next</code> that returns a recursive call
to <code>_stream</code> with <code>n + 1</code> as an argument. This is similar to the recursive
generator implementation we had earlier. Finally to kick it all off, we return a
closure that calls <code>_stream</code> with our initial value of <code>1</code>.</p>

<p>Now one thing that is slightly irritating is the way we have to consume values.
We consecutively have to call the initial stream or the <code>next</code> function. What we
need is some helper function that can grab multiple values from the stream and
return them.</p>

<h2 id="the-take-function">The <em>take</em> Function</h2>

<p>To help us solve the problem of consuming multiple values from a stream, we can
create the <code>take</code> function. <code>take</code> is a function that takes a number <code>n</code> and a
stream <code>str</code> and returns the first <code>n</code> values of <code>str</code>. An implementation of
<code>take</code> would look like:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">take.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">take</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_take</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">accum</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">return</span> <span class="nx">accum</span><span class="p">;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kr">const</span> <span class="p">&#x7b;</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">next</span> <span class="p">&#x7d;</span> <span class="o">=</span> <span class="nx">str</span><span class="p">();</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="nx">_take</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">accum</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="nx">_take</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">str</span><span class="p">,</span> <span class="p">[]);</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>Again, we use an internal function to help us. (We could use an optional
parameter with the outer function instead, but that might not be considered
strictly functional.) The internal function <code>_take</code> takes the same argument
types as the outer function <code>take</code>, <code>n</code> and <code>str</code>, as well as another argument
<code>accum</code>. <code>accum</code> is short for accumulator, and it will be an array that holds
the values we have consumed from the stream.</p>

<p>We use recursion with <code>_take</code> to obtain our stream values. We grab the current
<code>value</code> and the <code>next</code> function from the current stream at line 7. Then we make
the recursive call at line 9. Notice we pass in <code>n - 1</code> and the next function as
our new stream. We also concatenate the current value to the <code>accum</code> array,
producing a new array that we pass in as the new accumulator.</p>

<p>Remember that we decrement <code>n</code> with <code>n - 1</code> in our recursive call. This is
important because it will lead to our base case when <code>n === 0</code>. At that point,
we no longer want to consume values from the stream, so we return whatever is in
<code>accum</code>.</p>

<p>This implementation is not without its faults because it will have a quadratic
runtime thanks to our calls to <code>accum.concat</code>. We could fix that with mutation
via <code>array.push</code> or using a list like the one in my last <a href="/javascript/functional-javascript-lists-1/">functional programming
post</a>, but we won’t worry about that
here.</p>

<p>So, let’s use our new <code>take</code> function to get the first ten natural numbers:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">natural-numbers-take.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">naturalNumbers</span><span class="p">();</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">firstTen</span> <span class="o">=</span> <span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">nats</span><span class="p">);</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">firstTen</span><span class="p">);</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></div></div></pre></div></figure>

<p>Great! This is not only simpler, but a more declarative way of consuming values
from a stream.</p>

<h2 id="creating-other-streams">Creating Other Streams</h2>

<p>Now we could apply our new stream technique to create other infinite sequences.
What if we wanted to create a stream of the Fibonacci sequence? Remember the
Fibonacci sequence is a sequence of numbers where every number is the sum of the
previous two numbers in the sequence. We also need two base case numbers, 0 and 1.
Therefore, the sequence would be 0, 1, 1, 2, 3, 5, 8, etc. Implementing this as
a stream could look something like this:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">fibonacci-sequence-stream-1.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">fibonacciSequence</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="p">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="na">value</span><span class="p">:</span> <span class="nx">current</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nx">next</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">next</span><span class="p">,</span> <span class="nx">current</span> <span class="o">+</span> <span class="nx">next</span><span class="p">);</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="p">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">_stream</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">fibs</span> <span class="o">=</span> <span class="nx">fibonacciSequence</span><span class="p">();</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">firstTen</span> <span class="o">=</span> <span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">fibs</span><span class="p">);</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">firstTen</span><span class="p">);</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></div></div></pre></div></figure>

<p>Notice anything? Reapplying the stream technique to the Fibonacci sequence seems
duplicative. What we really need is a more DRY approach to creating streams.
Therefore, we need to abstract the construction of the stream data structure
into a reusable function. Then, we can build streams with just a function call:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">stream.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">stream</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">initial</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="p">&#x7b;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nx">value</span><span class="p">,</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nx">next</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="p">&#x7d;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">initial</span><span class="p">);</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>This implementation closely models what we already did with the natural numbers
and the Fibonacci sequence. We create an internal <code>_stream</code> function that takes
some value and then returns an object literal that wraps that value and a
closure that produces the next value. Notice in the <code>next</code> function when we make
our recursive call that we also call the <code>fn</code> argument that was supplied to
<code>stream</code>. This is the function that is responsible for actually generating the
next value. In the case of the natural numbers, it would be a function that adds
1 to its argument.</p>

<p>Now we can convert our two streams to use our new <code>stream</code> function:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">stream-usage.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">fibs</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">(([</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">next</span><span class="p">,</span> <span class="nx">current</span> <span class="o">+</span> <span class="nx">next</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">nats</span><span class="p">));</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">fibs</span><span class="p">));</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [0, 1, 1, 1, 1, 2, 2, 3, 3, 5, 5, 8, 8, 13, 13, 21, 21, 34, 34, 55]</span></div></div></pre></div></figure>

<p>With our new <code>stream</code> function, all we have to do is provide a recurrence
function and an initial value. Whatever is returned from the recurrence function
is used as the next value in the stream and is also the next argument to the
recurrence function (recurrence inception, I know). For the natural numbers,
that recurrence is simply adding 1 to the last number: <code>n + 1</code>.</p>

<p>But wait a minute! What is going on with the Fibonacci sequence? Our recurrence
function takes in an array and returns an array. Also, the output from
<code>console.log(take(10, fibs))</code> seems to be duplicating numbers. Recall that our
stream uses the return value from the recurrence function as the next argument
for the recurrence function. Also, recall that the Fibonacci sequence is defined
as the sequence of numbers where each number is the sum of the previous two
numbers. Therefore, we must use an array to keep track of the previous two
numbers. That presents a problem when we actually consume numbers in the
Fibonacci sequence. We only want the first element in each array returned from
the recurrence function. What we need is some way to map over streams.</p>

<h2 id="mapping-over-streams">Mapping Over Streams</h2>

<p>If streams are like lazy lists, then surely we can map over them
<a href="/functional-javascript-lists-1/#map">like lists</a>. However, we need to ensure
that a <code>map</code> function for streams does not consume the stream. That defeats the
purpose of the stream — not to mention that that would cause an infinite
loop.</p>

<p>Thus, <code>map</code> must produce a new stream itself. Then, when we consume the mapped
stream, we will get back the modified values of the original stream. We can
implement <code>map</code> like so:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">map.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">originalStr</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kr">const</span> <span class="p">&#x7b;</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">next</span> <span class="p">&#x7d;</span> <span class="o">=</span> <span class="nx">str</span><span class="p">();</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="p">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="na">value</span><span class="p">:</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nx">next</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="p">&#x7d;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">originalStr</span><span class="p">);</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>Essentially, what we do in <code>map</code> is reimplement our stream pattern from the
<code>stream</code> function. Our <code>initial</code> value will be the stream over which we want to
map. We also use an internal helper function called <code>_stream</code> that actually
produces the stream data structure.</p>

<p>When we return our stream data structure, we call the mapping function <code>fn</code> on the
recently consumed <code>value</code> from the original stream to produce the new <code>value</code>
property. With this implementation, we can lazily consume and transform the
values from the original stream. Now, we can fix our Fibonacci sequence along
with the aid of a helper function called <code>first</code>:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">fibonacci-mapped.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">first</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">fibs</span> <span class="o">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">stream</span><span class="p">(([</span><span class="nx">current</span><span class="p">,</span> <span class="nx">next</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">next</span><span class="p">,</span> <span class="nx">current</span> <span class="o">+</span> <span class="nx">next</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]));</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">fibs</span><span class="p">));</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></div></div></pre></div></figure>

<p>Awesome! That fixes our issue and feels very functional, at least in the sense
of composing functions to produce our stream. We could even use <code>map</code> to create
the sequence of even numbers from our sequence of natural numbers:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">even-numbers-sequence.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">evenNumbers</span> <span class="o">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">nats</span><span class="p">);</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">evenNumbers</span><span class="p">));</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [2, 4, 6, 8, 10, 12, 14, 16, 18, 20]</span></div></div></pre></div></figure>

<h2 id="filtering-streams">Filtering Streams</h2>

<p>So, we can map over our streams, but what if we wanted to filter values? For
example, with filtering we could create the sequence of odd numbers from our
natural numbers, or we could filter out numbers that are less than 42.
Unsurprisingly, we can write a <code>filter</code> function that is similar to our <code>map</code>
function:</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">filter.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">function</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">originalStr</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="kd">function</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="kr">const</span> <span class="p">&#x7b;</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">next</span> <span class="p">&#x7d;</span> <span class="o">=</span> <span class="nx">str</span><span class="p">();</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">if</span> <span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">&#x7b;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="k">return</span> <span class="p">&#x7b;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nx">value</span><span class="p">,</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="nx">next</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">          <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">&#x7d;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="p">&#x7d;;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7d;</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="k">return</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">&#x7d;</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">_stream</span><span class="p">(</span><span class="nx">originalStr</span><span class="p">);</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">filter-usage.js</span><a class="code-highlight-caption-link" href="https://gist.github.com/2e53bc2473c11ae03793">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">nats</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">oddNumbers</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">nats</span><span class="p">);</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kr">const</span> <span class="nx">gte42</span> <span class="o">=</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">&gt;=</span> <span class="mi">42</span><span class="p">,</span> <span class="nx">nats</span><span class="p">);</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">oddNumbers</span><span class="p">));</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [1, 3, 5, 7, 9, 11, 13, 15, 17, 19]</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nx">gte42</span><span class="p">));</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">// [42, 43, 44, 45, 46, 47, 48, 49, 50, 51]</span></div></div></pre></div></figure>

<p><code>filter</code>, like <code>map</code>, is very similar to the <code>stream</code> function. It uses the
original stream as the initial value, and its internal function <code>_stream</code>
filters over the consumed values of the original stream. <code>_stream</code> accomplishes
this by consuming a value and then running the filter callback <code>fn</code> on it. If
<code>fn</code> returns <code>true</code>, then <code>_stream</code> will essentially return what the original
stream data structure would have returned except the <strong>new</strong> <code>next</code> function
will filter on the <code>next</code> function from the <strong>original stream</strong>. If <code>fn</code> returns
<code>false</code>, then <code>_stream</code> will delegate its result by recursively calling itself
with the <code>next</code> function from the original stream.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Streams are a powerful concept in JavaScript and functional programming. We can
represent infinite sequences without consuming a ton of memory. We can also use
the concepts of composition to create new sequences from other sequences through
lazy helper functions like <code>map</code> and <code>filter</code>. This notion of composition is
critical to functional programming and helps reinforce other concepts like
modularity and the single responsibility principle. Streams are an important
tool in the bag of functional and JavaScript programmers.</p>

      <div class="social-share">
  <ul class="inline-list">
    <li class="facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Share</span></a>
    </li>
    <li class="twitter">
      <a href="https://twitter.com/intent/tweet?text=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a>
    </li>
    <li class="googleplus">
      <a href="https://plus.google.com/share?url=http://blog.jeremyfairbank.com/javascript/functional-javascript-streams-2/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a>
    </li>
  </ul>
</div>
      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <div itemscope itemtype="http://data-vocabulary.org/Person">
  
    <img itemprop="photo" src="http://blog.jeremyfairbank.com/images/bio-photo-1.jpg" class="bio-photo" alt="Jeremy Fairbank bio photo">
  
  <h3 itemprop="name">Jeremy Fairbank</h3>
  <p>
    <span itemprop="role">Web Developer</span>.
    <span itemprop="address" itemscope><span itemprop="locality">Tennessee</span></span>.
    Making the web with JavaScript.
  </p>
  
  <a href="http://twitter.com/ElPapaPollo" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  
  <a href="http://plus.google.com/+JeremyFairbank" class="author-social" target="_blank"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a>
  
  <a href="http://instagram.com/elpapapollo" class="author-social" target="_blank"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
  
  <a href="http://github.com/jfairbank" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
</div>
        </div>
        <p class="byline"><strong>Functional JavaScript Part 2: Streams</strong> was published on <time datetime="2015-08-07T00:00:00-04:00">August 07, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
    <div class="related-articles">
      <h4>You might also enjoy <small class="pull-right">(<a href="http://blog.jeremyfairbank.com/posts/">View all posts</a>)</small></h4>
      <ul>
      
        <li><a href="http://blog.jeremyfairbank.com/javascript/javascript-es7-function-bind-syntax/" title="JavaScript ES7 Function Bind Syntax">JavaScript ES7 Function Bind Syntax</a></li>
      
        <li><a href="http://blog.jeremyfairbank.com/javascript/functional-javascript-lists-1/" title="Functional JavaScript Part 1: Lists">Functional JavaScript Part 1: Lists</a></li>
      
        <li><a href="http://blog.jeremyfairbank.com/javascript/polymer-web-components-with-marionette-js/" title="Polymer Web Components with Marionette.js">Polymer Web Components with Marionette.js</a></li>
      
      </ul>
      <hr />
    </div><!-- /.related-articles -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2014 - 2015 Jeremy Fairbank. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>window.jQuery || document.write('<script src="http://blog.jeremyfairbank.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://blog.jeremyfairbank.com/assets/js/scripts.min.js"></script>

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-52148605-1', 'auto');
ga('require', 'linkid', 'linkid.js');
ga('require', 'displayfeatures');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jeremyfairbankblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
